<template>
    <div class="dragDropId">
        <!-- Header -->
        <div class="app-header">
            <h1>üöö Delivery Planning Dashboard</h1>
            <div class="header-actions">
                <button class="btn btn-secondary"><span>‚Üª</span>Refresh</button>
                <button class="btn btn-secondary"><span>üìä</span>Reports</button>
                <button class="btn btn-secondary"><span>‚öôÔ∏è</span>Settings</button>
            </div>
        </div>

        <!-- Toolbar for main page -->
        <div class="toolbar">
            <div class="filter-section left-side">
                <label>Customer:</label>
                <select name="customer" onchange={handleCustomerChange}>
                    <option value="all">All Customers</option>
                    <template for:each={accounts} for:item="acc">
                        <option key={acc.Id}>{acc.Name}</option>
                    </template>
                </select>
                <label>Product Family:</label>
                <select>
                    <option value="all">All Products</option>
                    <option value="Disc Plow (‡∏ö‡∏∏‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å)">Disc Plow (‡∏ö‡∏∏‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å)</option>
                    <option value="Disc Harrow (‡∏ú‡∏≤‡∏ô‡∏û‡∏£‡∏ß‡∏ô)">Disc Harrow (‡∏ú‡∏≤‡∏ô‡∏û‡∏£‡∏ß‡∏ô)</option>
                    <option value="Furrow Disc (‡∏Ñ‡∏±‡∏î‡∏ó‡πâ‡∏≤‡∏¢)">Furrow Disc (‡∏Ñ‡∏±‡∏î‡∏ó‡πâ‡∏≤‡∏¢)</option>
                    <option value="Notch Disc (‡πÉ‡∏ö‡∏à‡∏±‡∏Å‡∏£)">Notch Disc (‡πÉ‡∏ö‡∏à‡∏±‡∏Å‡∏£)</option>
                    <option value="Rotary Blade (‡πÇ‡∏£‡∏ï‡∏≤‡∏£‡∏µ‡πà)">Rotary Blade (‡πÇ‡∏£‡∏ï‡∏≤‡∏£‡∏µ‡πà)</option>
                    <option value="Dozer Blade (‡πÉ‡∏ö‡∏î‡∏±‡∏ô‡∏î‡∏¥‡∏ô)">Dozer Blade (‡πÉ‡∏ö‡∏î‡∏±‡∏ô‡∏î‡∏¥‡∏ô)</option>
                    <option value="Screw Flight (‡πÉ‡∏ö‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏ß)">Screw Flight (‡πÉ‡∏ö‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏ß)</option>
                    <option value="Implements (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠‡∏û‡πà‡∏ß‡∏á)">Implements (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠‡∏û‡πà‡∏ß‡∏á)</option>
                    <option value="etc. (‡∏≠‡∏∑‡πà‡∏ô ‡πÜ)">etc. (‡∏≠‡∏∑‡πà‡∏ô ‡πÜ)</option>
                </select>

                <label>Week</label>
                <lightning-input type="date" label="" value={selectedDate} onchange={handleDateChange}
                    placeholder="YYYY-MM-DD">
                </lightning-input>


            </div>
            <!-- stats section part -->
            <div class="stats-section right-side">
                <div class=" stat-item">
                    <div class="stat-value">{countPendingFulfillments}</div>
                    <div class="stat-label">Pending</div>

                </div>
                <div class=" stat-item">
                    <div class="stat-value">{countAssignedFulfillments}</div>
                    <div class="stat-label">Scheduled</div>
                </div>

                <div class=" stat-item">
                    <div class="stat-value">87%</div>
                    <div class="stat-label">Utilization</div>
                </div>

            </div>

        </div>

        <!-- Marker Capacity -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #0176d3;"></div>
                <span>Scheduled</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2e844a;"></div>
                <span>Under Capacity</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffa500;"></div>
                <span>Near Capacity</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #c23934;"></div>
                <span>At Capacity</span>
            </div>
        </div>


        <div class="scheduler-container">

            <!-- LEFT SIDE - ORDERS -->
            <div class="orders-panel">
                <div class="panel-header">
                    <h2>üìã Pending Fulfillments ({countPendingFulfillments})</h2>
                    <button class="btn btn-success w-100">‚ú® AI Auto-Schedule Selected ({countSelectedCheckbox})</button>
                    <!-- <button class="btn btn-primary mt-4 w-100">Submit</button> -->
                </div>

                <template for:each={pendingOrders} for:item="o">
                    <div key={o.id} class="order-card" draggable="true" data-id={o.id} data-name={o.name}
                        ondragstart={handleDragStart}>
                        <div class="header-card">
                            <div class="order-link">{o.name}</div>
                            <input type="checkbox" checked={o.checked} onchange={handleCheckbox} data-name={o.name} />
                        </div>

                        <div class="line-card flex justify-between" style="margin-bottom: 5px;">
                            <span class="label-card">Customer:</span> {o.customer}
                        </div>
                        <div class="line-card flex justify-between">
                            <span class="label-card">Product:</span>
                            <div>
                                <span class="truncate">{o.productCode}</span>
                                <lightning-helptext content={o.productCode}></lightning-helptext>

                            </div>
                        </div>

                        <div class="line-card flex justify-between">
                            <span class="label-card">Quantity:</span> {o.quantity}
                        </div>

                        <div class="order-weight">{o.weight} kg</div>
                    </div>
                </template>
            </div>

            <!-- RIGHT SIDE - CALENDAR -->
            <div class="calendar-panel">
                <template for:each={calendarData} for:item="day">
                    <div key={day.date} class="day-column">

                        <div class="day-header">
                            <div class="day-name">{day.dayName}</div>
                            <div class="day-date">{day.date}</div>
                        </div>

                        <template for:each={day.trucks} for:item="t">
                            <div key={t.truckId} class="truck-card" data-truck-id={t.truckId} data-date={day.date}
                                ondragover={handleDragOver} ondrop={handleDrop}>

                                <div class="truck-header">
                                    <div>
                                        <div class="truck-name truncate">{t.truckName} </div>
                                        <lightning-helptext content={t.tooltip}></lightning-helptext>
                                    </div>
                                    <div class={t.statusClass}>{t.remainingCapacity} kg</div>
                                </div>

                                <div class="truck-orders">
                                    <template for:each={t.assignedOrders} for:item="ord">
                                        <div key={ord} class="assigned-order">
                                            <div class="flex justify-between">
                                                {ord.name}
                                                <button class="remove-btn" data-id={ord.id} data-truck-id={t.truckId}
                                                    data-date={day.date} onclick={handleRemove}>
                                                    ‚úï
                                                </button>
                                            </div>
                                            <div class="">
                                                <label>{ord.productCode} - {ord.quantity} pcs</label>
                                            </div>
                                            <div class="">
                                                <label>{ord.weight} kg</label>
                                            </div>

                                        </div>
                                    </template>

                                    <template if:true={t.isEmpty}>
                                        <div class="empty-hint">Drop orders here</div>
                                    </template>
                                </div>

                            </div>
                        </template>
                    </div>
                </template>
            </div>

        </div>

    </div>
</template>
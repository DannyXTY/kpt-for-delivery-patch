<template>
    <div class="dragDropId">
        <!-- Header -->
        <div class="app-header">
            <h1>üöö Delivery Planning Dashboard</h1>
            <div class="header-actions">
                <button class="btn btn-secondary"><span>‚Üª</span>Refresh</button>
                <button class="btn btn-secondary"><span>üìä</span>Reports</button>
                <button class="btn btn-secondary"><span>‚öôÔ∏è</span>Settings</button>
            </div>
        </div>

        <!-- Toolbar for main page -->
        <div class="toolbar">
            <div class="filter-section left-side">
                <label>Customer:</label>
                <select name="customer" onchange={handleCustomerChange}>
                    <option value="all">All Customers</option>
                    <template for:each={accounts} for:item="acc">
                        <option key={acc.Id}>{acc.Name}</option>
                    </template>
                </select>
                <label>Product Type:</label>
                <select>
                    <option value="all">All Products</option>
                    <option value="DISC">DISC</option>
                    <option value="DOZER BLADE">DOZER BLADE</option>
                    <option value="PLOUGH">PLOUGH</option>
                    <option value="SCREW">SCREW</option>
                </select>

                <label>Week</label>
                <lightning-input type="date" label="" value={selectedDate} onchange={handleDateChange}
                    placeholder="YYYY-MM-DD">
                </lightning-input>


            </div>
            <!-- stats section part -->
            <div class="stats-section right-side">
                <div class=" stat-item">
                    <div class="stat-value">28</div>
                    <div class="stat-label">Pending</div>

                </div>
                <div class=" stat-item">
                    <div class="stat-value">42</div>
                    <div class="stat-label">Scheduled</div>
                </div>

                <div class=" stat-item">
                    <div class="stat-value">87%</div>
                    <div class="stat-label">Utilization</div>
                </div>

            </div>

        </div>

        <!-- Marker Capacity -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #0176d3;"></div>
                <span>Scheduled</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2e844a;"></div>
                <span>Under Capacity</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffa500;"></div>
                <span>Near Capacity</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #c23934;"></div>
                <span>At Capacity</span>
            </div>
        </div>


        <div class="scheduler-container">

            <!-- LEFT SIDE - ORDERS -->
            <div class="orders-panel">
                <div class="panel-header">
                    <h2>üìã Pending Fulfillments (28)</h2>
                    <button class="btn btn-success w-100">‚ú® AI Auto-Schedule Selected ({countSelectedCheckbox})</button>
                    <button class="btn btn-primary mt-4 w-100">Submit</button>
                </div>

                <template for:each={orders} for:item="o">
                    <div key={o.id} class="order-card" draggable="true" data-id={o.id} data-name={o.name}
                        ondragstart={handleDragStart}>
                        <div class="header-card">
                            <div class="order-link">{o.name}</div>
                            <input type="checkbox" checked={o.checked} onchange={handleCheckbox} data-name={o.name} />
                        </div>

                        <div class="line-card flex justify-between" style="margin-bottom: 5px;">
                            <span class="label-card">Customer:</span> {o.customer}
                        </div>
                        <div class="line-card flex justify-between">
                            <span class="label-card">Product:</span>
                            <div>
                                <span class="truncate">{o.productName}</span>
                                <lightning-helptext content={o.productName}></lightning-helptext>

                            </div>
                        </div>

                        <div class="line-card flex justify-between">
                            <span class="label-card">Quantity:</span> {o.quantity}
                        </div>

                        <div class="order-weight">{o.weight} kg</div>
                    </div>
                </template>
            </div>

            <!-- RIGHT SIDE - CALENDAR -->
            <div class="calendar-panel">
                <template for:each={calendarData} for:item="day">
                    <div key={day.date} class="day-column">

                        <div class="day-header">
                            <div class="day-name">{day.dayName}</div>
                            <div class="day-date">{day.date}</div>
                        </div>

                        <template for:each={day.trucks} for:item="t">
                            <div key={t.truckId} class="truck-card" data-truck-id={t.truckId} data-date={day.date}
                                ondragover={handleDragOver} ondrop={handleDrop}>

                                <div class="truck-header">
                                    <div class="truck-name">Truck {t.truckId}</div>
                                    <div class="truck-capacity">{t.capacity} kg</div>
                                </div>

                                <div class="truck-orders">
                                    <template for:each={t.assignedOrders} for:item="ord">
                                        <div key={ord} class="assigned-order">
                                            {ord}
                                            <button class="remove-btn" data-id={ord} data-truck-id={t.truckId}
                                                data-date={day.date} onclick={handleRemove}>
                                                ‚úï
                                            </button>

                                        </div>
                                    </template>

                                    <template if:true={t.isEmpty}>
                                        <div class="empty-hint">Drop orders here</div>
                                    </template>
                                </div>

                            </div>
                        </template>
                    </div>
                </template>
            </div>

        </div>

    </div>
</template>